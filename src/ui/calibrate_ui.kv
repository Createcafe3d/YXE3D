#:kivy 1.8.0
#:import _ __main__._
#:import FloatInput ui.custom_widgets.FloatInput
#:import CommunicativeTabbedPanel ui.custom_widgets.CommunicativeTabbedPanel


<CalibrateUI>:
    name: 'calibrationui'
    BoxLayout:
        orientation: 'vertical'
        CommunicativeTabbedPanel:
            id:tab_panel
            tab_pos: "top_left"
            do_default_tab: False
            CenterPanel:
                calibration_api: root.calibration_api
            OrientationPanel:
                calibration_api: root.calibration_api
            PrintAreaPanel:
                calibration_api: root.calibration_api
            AlignmentPanel:
                calibration_api: root.calibration_api
            CalibrationPanel:
                text: _('Top')
                calibration_type: 'top'
                calibration_height: 666
                calibration_api: root.calibration_api
            CalibrationPanel:
                text: _('Bottom')
                calibration_type: 'bottom'
                calibration_height: 0
                calibration_api: root.calibration_api
            TestPatternPanel:
                calibration_api: root.calibration_api
        Button:
            text: _("Back")
            size_hint_y: 30.0 / root.height
            on_release: app.root.current = 'mainui'

<CenterPanel>:
    text: _("Center")
    BoxLayout:
        orientation: 'horizontal'
        padding: 5
        ScrollView:
            size_hint_x: 0.6
            Label:
                text: _("MARKUP - Center Calibration Instructions")
                markup: True
                text_size: self.width, None
                size_hint_y: None
                height: self.texture_size[1]
        Image:
            pos: self.parent.pos
            size: self.parent.size
            source: "resources/grid.png"
            allow_stretch: True
            canvas.after:
                Color:
                    rgba: 0, 1, 0, 1
                Ellipse:
                    pos: [self.center[0] - 4, self.center[1] -4]
                    size: [8,8]

<OrientationPanel>:
    text: _("Orientation")
    BoxLayout:
        orientation: 'horizontal'
        BoxLayout:
            size_hint_x: 0.6
            orientation: 'vertical'
            BoxLayout:
                size_hint_y: 0.5
                orientation: 'vertical'
                BoxLayout:
                    size_hint_y: 40.0 / self.parent.height
                    orientation: 'horizontal'
                    Label:
                        text: "Flipped on X:"
                    Label:
                        text: root.orient_xflip
                BoxLayout:
                    size_hint_y: 40.0 / self.parent.height
                    orientation: 'horizontal'
                    Label:
                        text: "Flipped on y:"
                    Label:
                        text: root.orient_yflip
                BoxLayout:
                    size_hint_y: 40.0 / self.parent.height
                    orientation: 'horizontal'
                    Label:
                        text: 'Swapped Axis:'
                    Label:
                        text: root.orient_swap_axis
                Label:
            ScrollView:
                Label:
                    text: _("MARKUP - Orientation Instructions")
                    markup: True
                    text_size: self.width, None
                    size_hint_y: None
                    height: self.texture_size[1]
        GridLayout:
            id: orientations
            cols:4
            ToggleButton:
                state: 'down'
                configuration: (0, 0, 0)
                on_release: root.update_orientation(*self.configuration)
                id: orient_000
                allow_no_selection: False
                group: 'orientation'
                Image:
                    allow_stretch: True
                    center: self.parent.center
                    source: 'resources/orientation.png'
            ToggleButton:
                configuration: (0, 1, 1)
                on_release: root.update_orientation(*self.configuration)
                id: orient_011
                allow_no_selection: False
                group: 'orientation'
                Image:
                    allow_stretch: True
                    center: self.parent.center
                    source: 'resources/orientation.png'
                    canvas.before:
                        PushMatrix
                        Rotate:
                            angle: 270
                            axis: 0, 0, 1
                            origin: self.parent.center
                    canvas.after:
                        PopMatrix
            ToggleButton:
                configuration: (1, 0, 1)
                on_release: root.update_orientation(*self.configuration)
                id: orient_101
                allow_no_selection: False
                group: 'orientation'
                Image:
                    allow_stretch: True
                    center: self.parent.center
                    source: 'resources/orientation.png'
                    canvas.before:
                        PushMatrix
                        Rotate:
                            angle: 90
                            axis: 0, 0, 1
                            origin: self.parent.center
                    canvas.after:
                        PopMatrix
            ToggleButton:
                configuration: (1, 1, 0)
                on_release: root.update_orientation(*self.configuration)
                id: orient_110
                allow_no_selection: False
                group: 'orientation'
                Image:
                    allow_stretch: True
                    center: self.parent.center
                    source: 'resources/orientation.png'
                    canvas.before:
                        PushMatrix
                        Rotate:
                            angle: 180
                            axis: 0, 0, 1
                            origin: self.parent.center
                    canvas.after:
                        PopMatrix
            ToggleButton:
                configuration: (0, 1, 0)
                on_release: root.update_orientation(*self.configuration)
                id: orient_010
                allow_no_selection: False
                group: 'orientation'
                Image:
                    allow_stretch: True
                    center: self.parent.center
                    source: 'resources/orientation.png'
                    canvas.before:
                        PushMatrix
                        Rotate:
                            angle: 0
                            axis: 0, 0, 1
                            origin: self.parent.center
                        Rotate:
                            angle: 180
                            axis: 1, 0, 0
                            origin:self.parent.center
                    canvas.after:
                        PopMatrix
            ToggleButton:
                configuration: (1, 1, 1)
                on_release: root.update_orientation(*self.configuration)
                id: orient_111
                allow_no_selection: False
                group: 'orientation'
                Image:
                    allow_stretch: True
                    center: self.parent.center
                    source: 'resources/orientation.png'
                    canvas.before:
                        PushMatrix
                        Rotate:
                            angle: 270
                            axis: 0, 0, 1
                            origin: self.parent.center
                        Rotate:
                            angle: 180
                            axis: 1, 0, 0
                            origin:self.parent.center
                    canvas.after:
                        PopMatrix
            ToggleButton:
                configuration: (0, 0, 1)
                on_release: root.update_orientation(*self.configuration)
                id: orient_001
                allow_no_selection: False
                group: 'orientation'
                Image:
                    allow_stretch: True
                    center: self.parent.center
                    source: 'resources/orientation.png'
                    canvas.before:
                        PushMatrix
                        Rotate:
                            angle: 90
                            axis: 0, 0, 1
                            origin: self.parent.center
                        Rotate:
                            angle: 180
                            axis: 1, 0, 0
                            origin:self.parent.center
                    canvas.after:
                        PopMatrix
            ToggleButton:
                configuration: (1, 0, 0)
                on_release: root.update_orientation(*self.configuration)
                id: orient_100
                allow_no_selection: False
                group: 'orientation'
                Image:
                    allow_stretch: True
                    center: self.parent.center
                    source: 'resources/orientation.png'
                    canvas.before:
                        PushMatrix
                        Rotate:
                            angle: 180
                            axis: 0, 0, 1
                            origin: self.parent.center
                        Rotate:
                            angle: 180
                            axis: 1, 0, 0
                            origin:self.parent.center
                    canvas.after:
                        PopMatrix

<PrintAreaPanel>:
    text: _("Print Area")
    BoxLayout:
        orientation: 'horizontal'
        padding: 5
        ScrollView:
            size_hint_x: 0.6
            Label:
                text: _("MARKUP - Print Area Instructions")
                markup: True
                text_size: self.width, None
                size_hint_y: None
                height: self.texture_size[1]
        BoxLayout:
            orientation: 'vertical'
            BoxLayout:
                size_hint_y: 40.0 / self.parent.height
                orientation: 'horizontal'
                Label:
                    text: _('Height (mm)')
                FloatInput:
                    size_hint_x: 0.3
                    id: print_area_height
                    text: ""
                Label:
            BoxLayout:
                size_hint_y: 40.0 / self.parent.height
                orientation: 'horizontal'
                Label:
                    text: _('Depth (mm)')
                FloatInput:
                    size_hint_x: 0.3
                    id: print_area_depth
                    text: ""
                Label:
            BoxLayout:
                size_hint_y: 40.0 / self.parent.height
                orientation: 'horizontal'
                Label:
                    text: _('Width (mm)')
                FloatInput:
                    size_hint_x: 0.3
                    id: print_area_width
                    text: ""
                Label:
            Label:

<AlignmentPanel>:
    text: _("Aligment")
    BoxLayout:
        orientation: 'horizontal'
        padding: 5
        ScrollView:
            size_hint_x: 0.6
            Label:
                text: _("MARKUP - Alignment Instructions")
                markup: True
                text_size: self.width, None
                size_hint_y: None
                height: self.texture_size[1]
        Image:
            pos: self.parent.pos
            size: self.parent.size
            source: "resources/grid.png"
            allow_stretch: True
            canvas.after:
                Color:
                    rgba: 0, 1, 0, 1
                Line:
                    points: [self.pos[0] +5, self.center[1], self.pos[0]+self.size[0] -5, self.center[1]]
                    width: 4
                    cap: 'round'

<CalibrationPoint>:
    orientation: 'horizontal'
    Label:
        size_hint_x: 0.1
        canvas.after:
            Color:
                rgba: root.indicator_color
            Ellipse:
                pos: [self.center[0] - (self.width * 0.8) / 2.0, self.center[1] - (self.width * 0.8) / 2.0]
                size: [min(self.height, self.width) * 0.8, min(self.height, self.width) * 0.8]
    ToggleButton:
        group: root.group
        on_state: root.on_state(self.state)
        text: root.toggle_text
    Button:
        size_hint_x: 0.5
        text: _("Save")
        disabled: not root.active
        on_release: root.save_point()

<CalibrationPanel>:
    BoxLayout:
        orientation: 'horizontal'
        padding: 5
        BoxLayout:
            padding: 5
            size_hint_x: 0.6
            orientation: 'vertical'
            BoxLayout:
                orientation: 'vertical'
                size_hint_y: 2.0
                ToggleButton:
                    text: _('Super Accurate Mode')
                    on_release: root.super_accurate_mode(self)
                Label:
                    size_hint_y:0.2
                BoxLayout:
                    orientation: 'vertical'
                    size_hint: [1.0, len(self.children)]
                    id: point_selections
                Label:
                    text: root.printer_point_text
                    bold: root.printer_point_emphasis
                BoxLayout:
                    orientation: 'horizontal'
                    Button:
                        text: _('Reset All')
                        on_release: root.reset_points()
                    Button:
                        text: _('Save All')
                        disabled: not root.valid
                        on_release: root.save_all_points()
                Label:
                    size_hint_y:0.2
            Image:
                id: example_grid
                pos: self.parent.pos
                size: self.parent.size
                source: "resources/grid_small.png"
                allow_stretch: True
                canvas:
                    Color:
                        rgba: 0, 1, 0, 1
                    Ellipse:
                        pos: root.example_dot
                        size: [8,8]
            ScrollView:
                Label:
                    text: _("MARKUP - Calibration Instructions")
                    markup: True
                    text_size: self.width, None
                    size_hint_y: None
                    height: self.texture_size[1]
        Image:
            id: top_calibration_grid
            pos: self.parent.pos
            size: self.parent.size
            source: "resources/grid.png"
            allow_stretch: True
            canvas.before:
                Color:
                    rgba: 0.0, 0.0, 0.0, 1
                Rectangle:
                    pos:  [ self.x + max(0, self.width - self.height) / 2, self.y + max(0, self.height - self.width) / 2 ]
                    size: (min(self.size), min(self.size))
            canvas.after:
                Color:
                    rgba: 1, 0, 0, 1
                Ellipse:
                    pos: [root.calibration_point[0] - 4,root.calibration_point[1] - 4]
                    size: [8,8]

<TestPatternPanel>:
    text: _("Test Patterns")
    BoxLayout:
        orientation: 'horizontal'
        padding: 5
        BoxLayout:
            size_hint_x: 0.6
            orientation: 'vertical'
            BoxLayout:
                orientation: 'vertical'
                size_hint_y: 0.2
                BoxLayout:
                    Label:
                        text: _("Speed")
                    Label:
                        text: '%.f (mm/sec)' % root.speed
                Slider:
                    id: speed_slider
                    min: 1
                    step:5
                    max: 1000
                    value: root.speed
                    on_value: root.speed = self.value
            ScrollView:
                Label:
                    text: _("MARKUP - Test Pattern Instructions")
                    markup: True
                    text_size: self.width, None
                    size_hint_y: None
                    height: self.texture_size[1]

        GridLayout:
            id: patterns
            cols: 2
