#:kivy 1.8.0
#:import _ __main__._
#:import FloatInput ui.custom_widgets.FloatInput
#:import CommunicativeTabbedPanel ui.custom_widgets.CommunicativeTabbedPanel


<CalibrateUI>:
    name: 'calibrationui'
    BoxLayout:
        orientation: 'vertical'
        CommunicativeTabbedPanel:
            id:tab_panel
            tab_pos: "top_left"
            do_default_tab: False
            CenterPanel:
                calibration_api: root.calibration_api
            OrientationPanel:
                calibration_api: root.calibration_api
            PrintAreaPanel:
                calibration_api: root.calibration_api
            AlignmentPanel:
                calibration_api: root.calibration_api
            CalibrationPanel:
                text: _('Top')
                calibration_height: 666
                calibration_api: root.calibration_api
            CalibrationPanel:
                text: _('Bottom')
                calibration_height: 0
                calibration_api: root.calibration_api
            TestPatternPanel:
                calibration_api: root.calibration_api
        Button:
            text: _("Back")
            size_hint_y: 30.0 / root.height
            on_release: app.root.current = 'mainui'

<CenterPanel>:
    text: _("Center")
    BoxLayout:
        orientation: 'horizontal'
        padding: 5
        Label:
            size_hint_x: 0.6
            text: "INFO BOX HERE"
        Image:
            pos: self.parent.pos
            size: self.parent.size
            source: "resources/grid.png"
            allow_stretch: True
            canvas.after:
                Color:
                    rgba: 0, 1, 0, 1
                Ellipse:
                    pos: [self.center[0] - 4, self.center[1] -4]
                    size: [8,8]

<OrientationPanel>:
    text: _("Orientation")
    BoxLayout:
        orientation: 'horizontal'
        BoxLayout:
            orientation: 'vertical'
            size_hint_x: 0.6
            BoxLayout
                orientation: 'horizontal'
                Label:
                    text: 'Swapped Axis:'
                Label:
                    text: root.orient_swap_axis
            BoxLayout
                orientation: 'horizontal'
                Label:
                    text: "Flipped on X:"
                Label:
                    text: root.orient_xflip
            BoxLayout
                orientation: 'horizontal'
                Label:
                    text: "Flipped on y:"
                Label:
                    text: root.orient_yflip
        GridLayout:
            id: orientations
            cols:4
            ToggleButton:
                state: 'down'
                configuration: (0, 0, 0)
                on_release: root.update_orientation(*self.configuration)
                id: orient_000
                allow_no_selection: False
                group: 'orientation'
                Image:
                    allow_stretch: True
                    center: self.parent.center
                    source: 'resources/orientation.png'
            ToggleButton:
                configuration: (0, 1, 0)
                on_release: root.update_orientation(*self.configuration)
                id: orient_100
                allow_no_selection: False
                group: 'orientation'
                Image:
                    allow_stretch: True
                    center: self.parent.center
                    source: 'resources/orientation.png'
                    canvas.before:
                        PushMatrix
                        Rotate:
                            angle: 270
                            axis: 0, 0, 1
                            origin: self.parent.center
                    canvas.after:
                        PopMatrix
            ToggleButton:
                configuration: (1, 1, 0)
                on_release: root.update_orientation(*self.configuration)
                id: orient_101
                allow_no_selection: False
                group: 'orientation'
                Image:
                    allow_stretch: True
                    center: self.parent.center
                    source: 'resources/orientation.png'
                    canvas.before:
                        PushMatrix
                        Rotate:
                            angle: 90
                            axis: 0, 0, 1
                            origin: self.parent.center
                    canvas.after:
                        PopMatrix
            ToggleButton:
                configuration: (1, 0, 1)
                on_release: root.update_orientation(*self.configuration)
                id: orient_011
                allow_no_selection: False
                group: 'orientation'
                Image:
                    allow_stretch: True
                    center: self.parent.center
                    source: 'resources/orientation.png'
                    canvas.before:
                        PushMatrix
                        Rotate:
                            angle: 180
                            axis: 0, 0, 1
                            origin: self.parent.center
                    canvas.after:
                        PopMatrix
            ToggleButton:
                configuration: (0, 0, 1)
                on_release: root.update_orientation(*self.configuration)
                id: orient_010
                allow_no_selection: False
                group: 'orientation'
                Image:
                    allow_stretch: True
                    center: self.parent.center
                    source: 'resources/orientation.png'
                    canvas.before:
                        PushMatrix
                        Rotate:
                            angle: 0
                            axis: 0, 0, 1
                            origin: self.parent.center
                        Rotate:
                            angle: 180
                            axis: 1, 0, 0
                            origin:self.parent.center
                    canvas.after:
                        PopMatrix
            ToggleButton:
                configuration: (1, 1, 1)
                on_release: root.update_orientation(*self.configuration)
                id: orient_111
                allow_no_selection: False
                group: 'orientation'
                Image:
                    allow_stretch: True
                    center: self.parent.center
                    source: 'resources/orientation.png'
                    canvas.before:
                        PushMatrix
                        Rotate:
                            angle: 270
                            axis: 0, 0, 1
                            origin: self.parent.center
                        Rotate:
                            angle: 180
                            axis: 1, 0, 0
                            origin:self.parent.center
                    canvas.after:
                        PopMatrix
            ToggleButton:
                configuration: (0, 1, 1)
                on_release: root.update_orientation(*self.configuration)
                id: orient_110
                allow_no_selection: False
                group: 'orientation'
                Image:
                    allow_stretch: True
                    center: self.parent.center
                    source: 'resources/orientation.png'
                    canvas.before:
                        PushMatrix
                        Rotate:
                            angle: 90
                            axis: 0, 0, 1
                            origin: self.parent.center
                        Rotate:
                            angle: 180
                            axis: 1, 0, 0
                            origin:self.parent.center
                    canvas.after:
                        PopMatrix
            ToggleButton:
                configuration: (1, 0, 0)
                on_release: root.update_orientation(*self.configuration)
                id: orient_001
                allow_no_selection: False
                group: 'orientation'
                Image:
                    allow_stretch: True
                    center: self.parent.center
                    source: 'resources/orientation.png'
                    canvas.before:
                        PushMatrix
                        Rotate:
                            angle: 180
                            axis: 0, 0, 1
                            origin: self.parent.center
                        Rotate:
                            angle: 180
                            axis: 1, 0, 0
                            origin:self.parent.center
                    canvas.after:
                        PopMatrix

<PrintAreaPanel>:
    text: _("Print Area")
    BoxLayout:
        orientation: 'horizontal'
        padding: 5
        Label:
            size_hint_x: 0.6
            text: "INFO BOX HERE"
        BoxLayout:
            orientation: 'vertical'
            BoxLayout:
                orientation: 'horizontal'
                Label:
                    text: _('Height (mm)')
                FloatInput:
                    id: print_area_height
                    text: ""
            BoxLayout:
                orientation: 'horizontal'
                Label:
                    text: _('Depth (mm)')
                FloatInput:
                    id: print_area_depth
                    text: ""
            BoxLayout:
                orientation: 'horizontal'
                Label:
                    text: _('Width (mm)')
                FloatInput:
                    id: print_area_width
                    text: ""

<AlignmentPanel>:
    text: _("Aligment")
    BoxLayout:
        orientation: 'horizontal'
        padding: 5
        Label:
            size_hint_x: 0.6
            text: "INFO BOX HERE"
        Image:
            pos: self.parent.pos
            size: self.parent.size
            source: "resources/grid.png"
            allow_stretch: True
            canvas.after:
                Color:
                    rgba: 0, 1, 0, 1
                Line:
                    points: [self.pos[0] +5, self.center[1], self.pos[0]+self.size[0] -5, self.center[1]]
                    width: 4
                    cap: 'round'

<CalibrationPanel>:
    BoxLayout:
        orientation: 'horizontal'
        padding: 5
        BoxLayout:
            padding: 5
            size_hint_x: 0.6
            orientation: 'vertical'
            BoxLayout:
                orientation: 'vertical'
                Button:
                    text: _('Reset All Points')
                    on_release: root.reset_points()
                Label:
                GridLayout:
                    cols: 3
                    size_hint: [1.0, 4.0]
                    Label:
                        size_hint_x: 0.1
                    ToggleButton:
                        group:"top_calibaration"
                        id: upper_left
                        save_button_id: 'upper_left_save'
                        actual: [0.0, 0.0]
                        peachy: [0.0, 0.0]
                        example: [0.0, 1.0]
                        valid: False
                        on_release: root.on_point_selection(self)
                        state:'down'
                        text: _('Upper Left')
                        ellipse_color: [1,0,0,1]
                        canvas.after:
                            Color:
                                rgba: self.ellipse_color
                            Ellipse:
                                pos: [self.x - self.height * 0.8, self.y + self.height * 0.1]
                                size: [self.height * 0.8, self.height * 0.8]
                    Button:
                        id: upper_left_save
                        text: _("Save")
                        disabled: False
                        on_release: root.save_point()
                    Label:
                        size_hint_x: 0.1
                    ToggleButton:
                        group:"top_calibaration"
                        id: upper_right
                        save_button_id: 'upper_right_save'
                        actual: [0.0, 0.0]
                        peachy: [0.0, 0.0]
                        example: [1.0, 1.0]
                        valid: False
                        on_release: root.on_point_selection(self)
                        text: _('Upper Right')
                        ellipse_color: [1,0,0,1]
                        canvas.after:
                            Color:
                                rgba: self.ellipse_color
                            Ellipse:
                                pos: [self.x - self.height * 0.8, self.y + self.height * 0.1]
                                size: [self.height * 0.8, self.height * 0.8]
                    Button:
                        id: upper_right_save
                        text: _("Save")
                        disabled: True
                        on_release: root.save_point()
                    Label:
                        size_hint_x: 0.1
                    ToggleButton:
                        group:"top_calibaration"
                        id: lower_left
                        save_button_id: 'lower_left_save'
                        actual: [0.0, 0.0]
                        peachy: [0.0, 0.0]
                        example: [1.0, 0.0]
                        valid: False
                        on_release: root.on_point_selection(self)
                        text: _('Lower Left')
                        ellipse_color: [1,0,0,1]
                        canvas.after:
                            Color:
                                rgba: self.ellipse_color
                            Ellipse:
                                pos: [self.x - self.height * 0.8, self.y + self.height * 0.1]
                                size: [self.height * 0.8, self.height * 0.8]
                    Button:
                        id: lower_left_save
                        text: _("Save")
                        disabled: True
                        on_release: root.save_point()
                    Label:
                        size_hint_x: 0.1
                    ToggleButton:
                        group:"top_calibaration"
                        id: lower_right
                        save_button_id: 'lower_right_save'
                        actual: [0.0, 0.0]
                        peachy: [0.0, 0.0]
                        example: [0.0, 0.0]
                        valid: False
                        on_release: root.on_point_selection(self)
                        text: _('Lower Right')
                        ellipse_color: [1,0,0,1]
                        canvas.after:
                            Color:
                                rgba: self.ellipse_color
                            Ellipse:
                                pos: [self.x - self.height * 0.8, self.y + self.height * 0.1]
                                size: [self.height * 0.8, self.height * 0.8]
                    Button:
                        id: lower_right_save
                        text: _("Save")
                        disabled: True
                        on_release: root.save_point()
                Label:
                ToggleButton:
                    text: _('Super Accurate Mode')
                    on_release: root.super_accurate_mode(self)
                Button:
                    text: _('Save All Points')
                    disabled: True
                    on_release: root.save_points()
                Label:
            Image:
                id: example_grid
                pos: self.parent.pos
                size: self.parent.size
                source: "resources/grid_small.png"
                allow_stretch: True
                canvas:
                    Color:
                        rgba: 0, 1, 0, 1
                    Ellipse:
                        pos: root.example_dot
                        size: [8,8]
        Image:
            id: top_calibration_grid
            pos: self.parent.pos
            size: self.parent.size
            source: "resources/grid.png"
            allow_stretch: True
            canvas.before:
                Color:
                    rgba: 0.0, 0.0, 0.0, 1
                Rectangle:
                    pos:  [ self.x + max(0, self.width - self.height) / 2, self.y + max(0, self.height - self.width) / 2 ]
                    size: (min(self.size), min(self.size))
            canvas.after:
                Color:
                    rgba: 1, 0, 0, 1
                Ellipse:
                    pos: [root.calibration_point[0] - 4,root.calibration_point[1] - 4]
                    size: [8,8]

<TestPatternPanel>:
    text: _("Test Patterns")
    BoxLayout:
        orientation: 'horizontal'
        padding: 5
        Label:
            size_hint_x: 0.6
            text: "INFO BOX HERE"
        GridLayout:
            id: patterns
            cols: 2
